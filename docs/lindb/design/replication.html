<!DOCTYPE html><html lang="en" class="dark [--scroll-mt:9.875rem] [scrollbar-gutter:stable] lg:[--scroll-mt:6.3125rem]"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Replication - Lin</title><meta name="next-head-count" content="3"/><link rel="icon" href="/img/logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@8/themes/satellite-min.css"/><script>
                try {
                  if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark')
                    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0B1120')
                  } else {
                    document.documentElement.classList.remove('dark')
                  }
                } catch (_) {}
              </script><link rel="preload" href="/_next/static/css/ce4bca7d4b222059.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ce4bca7d4b222059.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-fe2d641fe691b132.js" defer=""></script><script src="/_next/static/chunks/framework-dab82874eb842bd1.js" defer=""></script><script src="/_next/static/chunks/main-1448cbf9d2b223a1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-13f13594fc30dab1.js" defer=""></script><script src="/_next/static/chunks/pages/docs/%5B%5B...slug%5D%5D-d4746155604a7421.js" defer=""></script><script src="/_next/static/-NtRW_Tocke_77ve0GfWf/_buildManifest.js" defer=""></script><script src="/_next/static/-NtRW_Tocke_77ve0GfWf/_ssgManifest.js" defer=""></script></head><body class="flex min-h-screen flex-col bg-white text-slate-500 antialiased dark:bg-slate-900 dark:text-slate-400"><div id="__next"><div class="pointer-events-none absolute inset-x-0 top-0 flex justify-center overflow-hidden"><div class="flex w-[108rem] flex-none justify-end"><picture><source srcSet="/_next/static/media/docs@30.8b9a76a2.avif" type="image/avif"/><img src="/_next/static/media/docs@tinypng.d9e4dcdc.png" alt="" class="w-[71.75rem] max-w-none flex-none dark:hidden" decoding="async"/></picture><picture><source srcSet="/_next/static/media/docs-dark@30.1a9f8cbf.avif" type="image/avif"/><img src="/_next/static/media/docs-dark@tinypng.1bbe175e.png" alt="" class="hidden w-[90rem] max-w-none flex-none dark:block" decoding="async"/></picture></div></div><div class="flex min-h-screen flex-col"><header class="sticky top-0 z-40 w-full flex-none bg-white leading-8 lg:z-50 lg:border-b lg:border-slate-900/10 lg:bg-white/75 lg:backdrop-blur-sm dark:border-slate-50/[0.06] dark:bg-slate-900 lg:dark:bg-transparent"><div class="mx-auto max-w-8xl"><div class="mx-4 border-b border-slate-900/10 py-3 lg:mx-0 lg:border-0 lg:px-8 lg:py-4 dark:border-slate-300/10"><div class="relative flex items-center"><div class="relative ml-auto flex flex-1 items-center"><nav class="flex flex-1 items-center text-sm font-semibold leading-6 text-slate-700 dark:text-slate-200"><a target="_self" href="/"><img src="/img/logo.svg" alt="Lin Labs Logo" class="size-7"/></a><div class="hidden lg:ml-16 lg:block"><ul class="flex space-x-6"><div data-headlessui-state=""><button class="font-semibold  focus:outline-none data-[hover]:text-sky-500 dark:data-[hover]:text-sky-400" type="button" aria-expanded="false" data-headlessui-state="">Open source</button></div><div hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><li class="hover:cursor-pointer"><a target="_self" class="hover:text-sky-500 dark:hover:text-sky-400" href="/docs/lindb/introduction">Docs</a></li><li class="hover:cursor-pointer"><a target="_self" class="hover:text-sky-500 dark:hover:text-sky-400" href="/downloads/lindb">Downloads</a></li></ul></div></nav><div class="flex items-center gap-4"><button class="flex items-center" id="headlessui-menu-button-:R1pj6:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-5"><path fill-rule="evenodd" d="M9 2.25a.75.75 0 0 1 .75.75v1.506a49.384 49.384 0 0 1 5.343.371.75.75 0 1 1-.186 1.489c-.66-.083-1.323-.151-1.99-.206a18.67 18.67 0 0 1-2.97 6.323c.318.384.65.753 1 1.107a.75.75 0 0 1-1.07 1.052A18.902 18.902 0 0 1 9 13.687a18.823 18.823 0 0 1-5.656 4.482.75.75 0 0 1-.688-1.333 17.323 17.323 0 0 0 5.396-4.353A18.72 18.72 0 0 1 5.89 8.598a.75.75 0 0 1 1.388-.568A17.21 17.21 0 0 0 9 11.224a17.168 17.168 0 0 0 2.391-5.165 48.04 48.04 0 0 0-8.298.307.75.75 0 0 1-.186-1.489 49.159 49.159 0 0 1 5.343-.371V3A.75.75 0 0 1 9 2.25ZM15.75 9a.75.75 0 0 1 .68.433l5.25 11.25a.75.75 0 1 1-1.36.634l-1.198-2.567h-6.744l-1.198 2.567a.75.75 0 0 1-1.36-.634l5.25-11.25A.75.75 0 0 1 15.75 9Zm-2.672 8.25h5.344l-2.672-5.726-2.672 5.726Z" clip-rule="evenodd"></path></svg></button><button class="flex items-center" id="headlessui-menu-button-:R1qj6:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-5 fill-sky-400/20 stroke-sky-500 dark:hidden "><path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59ZM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75ZM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591ZM12 18a.75.75 0 0 1 .75.75V21a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18ZM7.758 17.303a.75.75 0 0 0-1.061-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59ZM6 12a.75.75 0 0 1-.75.75H3a.75.75 0 0 1 0-1.5h2.25A.75.75 0 0 1 6 12ZM6.697 7.757a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591Z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="hidden size-5 fill-sky-400/20 stroke-sky-500 dark:inline"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg></button><a target="_blank" class="block text-slate-600 hover:text-slate-700 dark:text-gray-200 dark:hover:text-slate-300" href="https://github.com/lindb/lindb"><span class="sr-only">LinDB on GitHub</span><svg viewBox="0 0 16 16" class="size-5" fill="currentColor" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a><div class="w-32 lg:w-48"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="-my-1 lg:hidden"><button type="button" class="flex size-5 items-center justify-center text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300"><span class="sr-only">Navigation</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-5"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" clip-rule="evenodd"></path></svg></button></div></div></div></div></div></div></header><div class="sticky top-[3.3rem] z-50 flex items-center border-b border-slate-900/10 bg-white p-4 leading-6 lg:hidden lg:bg-white/75 lg:backdrop-blur-sm dark:border-slate-50/[0.06] dark:bg-slate-900 lg:dark:bg-transparent"><button type="button" class="text-slate-500 hover:text-slate-600 dark:text-slate-400 dark:hover:text-slate-300"><span class="sr-only">Navigation</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-6"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg></button><ol class="ml-4 flex min-w-0 whitespace-nowrap text-sm leading-6"><li class="flex items-center">Design<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-5"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></li><li class="truncate font-semibold text-slate-900 dark:text-slate-200">Replication</li></ol></div><main class="flex flex-1 pt-4"><div class="mx-auto flex max-w-8xl flex-1 flex-col px-4 sm:px-6 md:px-8"><div><div class="z-20 w-52 overflow-y-auto pb-10 lg:block xl:w-[19rem] hidden pl-8 fixed inset-0 left-[max(0px,calc(50%-45rem))] right-auto top-[3.8125rem]"><nav class="relative pt-5 lg:text-sm lg:leading-6"><ul><li><a target="_self" class="group mb-4 flex items-center font-semibold lg:text-sm lg:leading-6 text-slate-900 dark:text-slate-200 hover:text-slate-900  dark:hover:text-slate-300" href="/docs/lindb/introduction"><div class="mr-4 rounded-md p-1 shadow-sm ring-1 ring-slate-900/5 group-hover:shadow group-hover:shadow-violet-200 group-hover:ring-slate-900/10 dark:bg-slate-800 dark:shadow-none dark:ring-0 dark:group-hover:shadow-slate-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-4 fill-cyan-500 group-hover:fill-cyan-600"><path d="M11.25 4.533A9.707 9.707 0 0 0 6 3a9.735 9.735 0 0 0-3.25.555.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 1 .707A8.237 8.237 0 0 1 6 18.75c1.995 0 3.823.707 5.25 1.886V4.533ZM12.75 20.636A8.214 8.214 0 0 1 18 18.75c.966 0 1.89.166 2.75.47a.75.75 0 0 0 1-.708V4.262a.75.75 0 0 0-.5-.707A9.735 9.735 0 0 0 18 3a9.707 9.707 0 0 0-5.25 1.533v16.103Z"></path></svg></div>Introduction</a></li><li><a target="_self" class="group mb-4 flex items-center font-semibold lg:text-sm lg:leading-6 text-slate-900 dark:text-slate-200 hover:text-slate-900  dark:hover:text-slate-300" href="/docs/lindb/release-notes"><div class="mr-4 rounded-md p-1 shadow-sm ring-1 ring-slate-900/5 group-hover:shadow group-hover:shadow-violet-200 group-hover:ring-slate-900/10 dark:bg-slate-800 dark:shadow-none dark:ring-0 dark:group-hover:shadow-slate-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-4 fill-violet-400 group-hover:fill-violet-500"><path fill-rule="evenodd" d="M9.315 7.584C12.195 3.883 16.695 1.5 21.75 1.5a.75.75 0 0 1 .75.75c0 5.056-2.383 9.555-6.084 12.436A6.75 6.75 0 0 1 9.75 22.5a.75.75 0 0 1-.75-.75v-4.131A15.838 15.838 0 0 1 6.382 15H2.25a.75.75 0 0 1-.75-.75 6.75 6.75 0 0 1 7.815-6.666ZM15 6.75a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Z" clip-rule="evenodd"></path><path d="M5.26 17.242a.75.75 0 1 0-.897-1.203 5.243 5.243 0 0 0-2.05 5.022.75.75 0 0 0 .625.627 5.243 5.243 0 0 0 5.022-2.051.75.75 0 1 0-1.202-.897 3.744 3.744 0 0 1-3.008 1.51c0-1.23.592-2.323 1.51-3.008Z"></path></svg></div>Releases</a></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Getting Started</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/getting-started/docker">Docker</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/getting-started/package">Package</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Developer Guide</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/developer-guide/connect">Connect</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/developer-guide/create-database">Create a database</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/developer-guide/insert-data">Insert data</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/developer-guide/query-data">Query data</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Deployment</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/deployment/kubernetes">Kubernetes</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/deployment/manual">Manual deployment</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Client</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/client/cli">CLI</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/client/client-libraries">Client libraries</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/client/go">Go</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/client/java">Java</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Lin QL</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/lin-ql/sql">Lin query language</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Admin Console</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/admin-console/index">Introduction</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/admin-console/overview">Cluster overview</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/admin-console/search">Data search</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/admin-console/explore">Data explore</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/admin-console/monitoring">Cluster monitoring</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/admin-console/metadata">Metadata</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">API</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/api/index">Introduction</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/api/insert">Insert</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/api/query">Query</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/api/state">State</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Reference</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/reference/data-model">Data Model</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/reference/metric">Metric</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/reference/configuration">Configuration</a></li></ul></li><li class="mt-4"><h5 class="mb-2 font-semibold text-slate-900 lg:mb-3 dark:text-slate-200">Design</h5><ul class="space-y-2 border-l border-slate-100 lg:space-y-2 dark:border-slate-800"><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/architecture">Architecture</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/coordinator">Coordinator</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 text-sky-500 border-current font-semibold dark:text-sky-400" href="/docs/lindb/design/replication">Replication</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/query">Query</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/storage">Storage</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/memory-database">Memory database</a></li><li class=""><a target="_self" class="-ml-px block border-l pl-4 border-transparent hover:border-slate-400 dark:hover:border-slate-500 text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/inverted-index">Inverted index</a></li></ul></li></ul></nav></div></div><div class="flex-1 lg:pl-36 xl:pl-[19.5rem]"><div class="mx-auto max-w-3xl xl:ml-0 xl:mr-[15.5rem] xl:max-w-none xl:pr-16"><header id="header" class="relative border-b border-gray-200 pb-4 dark:border-gray-800 "><div><p class="mb-2 hidden text-sm font-semibold leading-6 text-sky-500 lg:block dark:text-sky-400">Design</p><div class="flex items-center"><h1 class="inline-block text-2xl font-extrabold tracking-tight text-slate-900 sm:text-3xl dark:text-slate-200">Replication</h1></div></div><div class="mt-1 text-sm italic">Last updated on<!-- --> <span class="font-medium text-slate-900 underline decoration-sky-500 dark:text-slate-200">Mon Jun 24 07:03:27 2024</span> <!-- -->by<!-- --> <span class="font-medium text-slate-900 underline decoration-sky-500 dark:text-slate-200">stone1100</span></div></header><div id="content-wrapper" class="prose prose-slate relative mt-8 dark:prose-dark"><h2 id="overview" heading="2" href="#overview"><a class="group relative border-none lg:-ml-2 lg:pl-2" href="/docs/lindb/design/replication#overview"><span class="absolute -ml-8 hidden items-center border-0 opacity-0 group-hover:opacity-100 group-focus:opacity-100 lg:flex">​<span class="flex size-6 items-center justify-center rounded-md text-slate-400 shadow-sm ring-1 ring-slate-900/5 hover:text-slate-700 hover:shadow hover:ring-slate-900/10 dark:bg-slate-800 dark:text-slate-400 dark:shadow-none dark:ring-0 dark:hover:bg-slate-700 dark:hover:text-slate-200"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></span></span>Overview</a></h2>
<p>For the replication of distributed storage, consensus protocols such as Paxos, Raft, and ZAB are commonly used in the industry. More than half of these protocols will sacrifice certain performance to strictly ensure data consistency.</p>
<p>The scenario faced by <strong>LinDB</strong> is that the amount of writing is huge, and the requirements for data consistency are not high. It also allows short-term data inconsistency and eventually consistent. Therefore, <strong>LinDB</strong> adopts the strategy that when successfully written to the <strong>Leader</strong> the write operation is successful.</p>
<p>Written to <strong>Leader</strong> is successful has the following benefits:</p>
<ul>
<li>Improving write performance;</li>
<li>Any machine can be deployed in the cluster, while Paxos, Raft, ZAB, etc. require at least 3 machines;</li>
</ul>
<p>Written to <strong>Leader</strong> is successful, has the following problems:</p>
<ul>
<li>Data consistency problem: once the <strong>Leader</strong> is down, a new <strong>Leader</strong> will be elected, then the new <strong>Leader</strong> copying new data may overwrite the data written by the old <strong>Leader</strong>;</li>
<li>Data loss problem: once <strong>Leader</strong> is down, and the data block which was not copied to <strong>Follower</strong> is also damaged at this time, this part of data will be lost;</li>
</ul>
<p>In order to solve the above problems and try to ensure that data is not lost, <strong>LinDB</strong> adopts a multichannel replication scheme, as shown in the following figure:</p>
<p><span class="not-prose flex flex-col text-center"><img src="/img/lindb/design/storage_database.png" alt="Databae storage shard" decoding="async" class="mx-auto"/><span class="mt-2 text-sm font-semibold italic">Databae storage shard</span></span></p>
<p>Take the data shard <strong>Shard 3</strong> as an example:</p>
<ul>
<li>When <strong>Node 1</strong> is a <strong>Leader</strong>, <strong>1-WAL</strong> write channel is enabled, <strong>Node 1</strong> receives new data and writes it to the <strong>1-WAL</strong> channel, and replicating the data into <strong>1-WAL</strong> channel of <strong>Node 2</strong> and <strong>Node 4</strong>;</li>
<li>When <strong>Node 1</strong> is down and <strong>Node 2</strong> is elected as the new <strong>Leader</strong>, the <strong>2-WAL</strong> write channel is enabled, and <strong>Node 2</strong> receives new data and replicating the data into <strong>2-WAL</strong> channel of <strong>Node 4</strong>;</li>
<li>When <strong>Node 1</strong> is up again, <strong>Node 1</strong> continue to copy the data into <strong>1-WAL</strong> channel that has not been copied to <strong>Node 2</strong> and <strong>Node 4</strong> to their corresponding <strong>1-WAL</strong> channels . <strong>Node 2</strong> will supplement the data in the <strong>2-WAL</strong> channel to the <strong>2-WAL</strong> channel of <strong>Node 1</strong>;</li>
</ul>
<p>That is, data in write channel flows from <strong>Leader</strong>. For example, the <strong>1-WAL</strong> channel is always the <strong>Node 1</strong> replication channel to <strong>Node 2</strong> and <strong>Node 4</strong>, and the <strong>2-WAL</strong> channel is always <strong>Node 2</strong> replication channels to <strong>Node 1</strong> and <strong>Node 4</strong>, <strong>4-WAL</strong> channel is always <strong>Node 4</strong> replication channel to <strong>Node 1</strong> and <strong>Node 2</strong>, and so on,</p>
<div class="markdown-alert markdown-alert-tip" dir="auto">
<p class="markdown-alert-title" dir="auto"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>TIP</p>
<p><strong>Node 1</strong> corresponds to the unique identifier <strong>1</strong> in the cluster, and so on for other nodes.</p>
</div>
<p>This way of replication solves the following problems:</p>
<ul>
<li>Avoid data inconsistency: only one node is responsible for the authority of the data for each channel, so there will be no conflict;</li>
<li>Avoid data loss as much as possible: as long as the data which has not been copied in the old <strong>Leader</strong> is still persistent at disk, it will be copied to other replicas after it gets up again. If the data that has not been copied in the old <strong>Leader</strong> is lost, then which will be lost forever;</li>
</ul>
<p>Preconditions for multichannel replication:</p>
<ul>
<li>Out of order is allowed: data written to multiple channels loses its order. Transactions are not required for Time series data scenarios faced by <strong>LinDB</strong> so out of order is allowed.</li>
</ul>
<div class="markdown-alert markdown-alert-tip" dir="auto">
<p class="markdown-alert-title" dir="auto"><svg class="octicon" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>TIP</p>
<p>Since a major feature of time series data is time correlation, <strong>LinDB</strong> also shards data by time according to this feature when storing data. Each time shard is a storage unit, so the actual replication channel is also stored with Units correspond one-to-one.</p>
</div>
<h2 id="local-replication" heading="2" href="#local-replication"><a class="group relative border-none lg:-ml-2 lg:pl-2" href="/docs/lindb/design/replication#local-replication"><span class="absolute -ml-8 hidden items-center border-0 opacity-0 group-hover:opacity-100 group-focus:opacity-100 lg:flex">​<span class="flex size-6 items-center justify-center rounded-md text-slate-400 shadow-sm ring-1 ring-slate-900/5 hover:text-slate-700 hover:shadow hover:ring-slate-900/10 dark:bg-slate-800 dark:text-slate-400 dark:shadow-none dark:ring-0 dark:hover:bg-slate-700 dark:hover:text-slate-200"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></span></span>Local replication</a></h2>
<p><span class="not-prose flex flex-col text-center"><img src="/img/lindb/design/local_replication.png" alt="Local replication" decoding="async" class="mx-auto"/><span class="mt-2 text-sm font-semibold italic">Local replication</span></span></p>
<p>The entire Local Replication writing process is as follows:</p>
<ul>
<li>The system will start a writing goroutine for each <strong>Shard</strong> replication channel, this goroutine is responsible for all write operations on this channel, whatever it is a <strong>Leader</strong> or a <strong>Follower</strong>;</li>
<li>First, data corresponding to <strong>namespace/metric name/tags/fields</strong> into the index file of the database will be written, and the corresponding <strong>metric id/time series id/field id</strong> will be generated, this operation is  mainly about completing the conversion of <strong>string-&gt;int</strong>; Advantage of this conversion is that all data are stored in data types to reduce the overall storage size, because for each data point, metadata such as <strong>namespace/metric name/tags/fields</strong> is occupied by such as <strong>cpu{host= 1.1.1.1} load=1 <a target="_blank" href="https://github.com/lindb/lindb/commit/1514214168614"><code>1514214</code></a></strong>,
In fact, after converting to <strong>id</strong>, the storage will be <strong>cpu =&gt; 1(metric id), host=1.1.1.1 =&gt; 1(time series id), load =&gt; 1(field id)</strong>, simplified to <strong>1 1 <a target="_blank" href="https://github.com/lindb/lindb/commit/1514214168614"><code>1514214</code></a> =&gt;1</strong>, please refer to <a target="_self" href="/docs/lindb/design/inverted-index">inverted index</a> for the specific index structure;</li>
<li>If writing index operation fails, it is considered that the writing has failed, and the failure is composed of two cases;<!-- -->
<ol>
<li>Bad data writing format, such failures are directly marked as failures;</li>
<li>Internal failure, the writing operations will be retried;</li>
</ol>
</li>
<li>When obtained <strong>ID</strong>, data will be written into storage uint, this process is similar to <strong>LSM</strong>, which writes data into the memory database firstly, and directly write to the memory to achieve high throughput performance. After the size of memory data reaches the memory limit, the <strong>Flush</strong> operation will be triggered. For details, please refer to <a target="_self" href="/docs/lindb/design/storage">Storage Format</a>, <a target="_self" href="/docs/lindb/design/memory-database">Memory Database</a>;</li>
</ul>
<p>Here are two import replication <strong>Index</strong> for write operations:</p>
<ul>
<li><strong>Consume(Replica) Index</strong>: where the writing goroutine has been processed, each write operation will first verify whether the <strong>Index</strong> is legal;</li>
<li><strong>Ack Index</strong>: which data in this channel has been successfully written and persisted to storage;</li>
</ul>
<p>Here are a few things to note:</p>
<ol>
<li>The writing goroutine will consume the written data from the <strong>WAL</strong> channel in order, so the <strong>Replica Index</strong> is an ordered pointer, so it is easy to check with the persisted <strong>Index</strong> to verify the data whether it has been written;</li>
<li>The <strong>Flush</strong> goroutine is used to synchronize the <strong>Ack Index</strong> to notify which data has been written successfully;</li>
<li>Since all write operations write into memory firstly, and then persist the data into corresponding file. If the system crashes during this process, as there is no <strong>Ack Index</strong>, even if the data in the memory is lost, but when the goroutine starts again, it consumes the data in the <strong>WAL</strong> channel with <strong>Ack Index</strong> as the current <strong>Replica Index</strong>. This consuming process achieved that data can be recovered after crashing;</li>
</ol>
<h2 id="remote-replication" heading="2" href="#remote-replication"><a class="group relative border-none lg:-ml-2 lg:pl-2" href="/docs/lindb/design/replication#remote-replication"><span class="absolute -ml-8 hidden items-center border-0 opacity-0 group-hover:opacity-100 group-focus:opacity-100 lg:flex">​<span class="flex size-6 items-center justify-center rounded-md text-slate-400 shadow-sm ring-1 ring-slate-900/5 hover:text-slate-700 hover:shadow hover:ring-slate-900/10 dark:bg-slate-800 dark:text-slate-400 dark:shadow-none dark:ring-0 dark:hover:bg-slate-700 dark:hover:text-slate-200"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></span></span>Remote replication</a></h2>
<p>Pick <strong>Node 1</strong> as <strong>Leader</strong> in the above figure with 3 Replications replicating data from <strong>1-WAL</strong> as an example:</p>
<p><strong>Node 1</strong> acts a <strong>Leader</strong> of the shard to accept written data from <strong>Broker</strong>, <strong>Node 2</strong> and <strong>Node 4</strong> are both <strong>Follower</strong> accepting the replication request of <strong>Node 1</strong>, meanwhile the <strong>1-WAL</strong> channel is used as data write channel.</p>
<p><span class="not-prose flex flex-col text-center"><img src="/img/lindb/design/remote_replication.png" alt="Remote replication" decoding="async" class="mx-auto"/><span class="mt-2 text-sm font-semibold italic">Remote replication</span></span></p>
<p><strong>Index</strong> basic concept description:</p>
<ul>
<li><strong>Append Index</strong> of each channel, indicating the writing position of the channel ;</li>
<li>Each channel retains each <strong>Follower Consumer (Replica) Index</strong> and <strong>Ack Index</strong>, respectively indicating the position where each <strong>Follower</strong> is consumed (consumed but the request is still without successful consumption acknowledged) and position of successful consumption;</li>
<li><strong>Tail Index</strong> of each channel: indicates the minimum value of all <strong>Follower Ack Index</strong>, <strong>WAL</strong> before the <strong>Index</strong> is deletable ;</li>
</ul>
<p>The entire replication process is as follows:</p>
<ul>
<li><strong>Leader</strong> will start an independent goroutine for each <strong>Follower</strong> replication, get <strong>Follower Consumer(Replica) Index</strong> from <strong>WAL</strong> of <strong>Leader</strong> then send it to <strong>Follower</strong>;</li>
<li><strong>Follower</strong> compares the <strong>Append Index</strong> with <strong>Consumer(Replica) Index</strong> in local <strong>WAL</strong>;<!-- -->
<ul>
<li>On equal: return <strong>Consumer Index</strong> to <strong>Leader</strong> as <strong>Ack Index</strong> (normal case);</li>
<li>On not equal, return the <strong>Append Index</strong> in its own local <strong>WAL</strong> to <strong>Leader</strong>;</li>
</ul>
</li>
<li>After <strong>Leader</strong> receiving response, detect whether the <strong>Ack Index</strong> of<strong>Follower</strong> is equal to <strong>Consumer(Replica) Index</strong>;<!-- -->
<ul>
<li>On equal: update the <strong>Ack Index</strong> of the <strong>Follower</strong> (normal case);</li>
<li>On not equal: here are some cases:<!-- -->
<ul>
<li>On <strong>Follower Ack Index</strong> smaller than <strong>Tail Index</strong> of <strong>Leader WAL</strong>: this means that <strong>Follower</strong> local <strong>Append Index</strong> is too small while <strong>Leader</strong> has no data at that position, then <strong>Follower</strong> should reset its own <strong>Append Index</strong> as <strong>Tail Index</strong> of <strong>Leader</strong>;</li>
<li>On <strong>Follower Ack Index</strong> is greater than the <strong>Append Index</strong> of the <strong>Leader WAL</strong>: this means that the <strong>Append Index</strong> of the <strong>Follower</strong> is too large, and the <strong>Leader</strong> has no data at this position, and the <strong>Leader WAL</strong> needs to be changed. Append Index** is raised to <strong>Follower Ack Index</strong>, and <strong>Follower Consumer(Replica) Index</strong> is raised to <strong>Follower Ack Index</strong>;</li>
<li>On <strong>Follower</strong> is between <strong>Tail Index</strong> and <strong>Append Index</strong> of <strong>Leader WAL</strong>: <strong>Follower Consumer(Replica) Index</strong> will be reset to <strong>Follower Ack Index</strong>;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The process of <strong>Leader</strong> and <strong>Follower</strong> to initialize the replication channel is similar to <strong>TCP</strong> three-way handshake.</p>
<h2 id="sequentiality" heading="2" href="#sequentiality"><a class="group relative border-none lg:-ml-2 lg:pl-2" href="/docs/lindb/design/replication#sequentiality"><span class="absolute -ml-8 hidden items-center border-0 opacity-0 group-hover:opacity-100 group-focus:opacity-100 lg:flex">​<span class="flex size-6 items-center justify-center rounded-md text-slate-400 shadow-sm ring-1 ring-slate-900/5 hover:text-slate-700 hover:shadow hover:ring-slate-900/10 dark:bg-slate-800 dark:text-slate-400 dark:shadow-none dark:ring-0 dark:hover:bg-slate-700 dark:hover:text-slate-200"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></span></span>Sequentiality</a></h2>
<p>Generally speaking, multichannel replication does not guarantee the order of the overall data. In most cases, only one of the channels is used. It is necessary to ensure the order of replication of the channel. With sequentiality, it is easier to know which data has been copied. Which data has not been replicated.</p>
<p>To ensure the sequentiality of replication process, it is necessary to ensure the order of the following steps:</p>
<ul>
<li><strong>Leader</strong> send replication requests in order;</li>
<li><strong>Follower</strong> processes replication request in order;</li>
<li><strong>Leader</strong> responses to replication request in order;</li>
</ul>
<p>Since the entire writing and replication process is based on the <strong>GRPC Stream</strong> long connection and single-goroutine processing mechanism, the above conditions can basically be guaranteed.</p>
<h4 id="reference" heading="4" href="#reference"><a class="group relative border-none lg:-ml-2 lg:pl-2" href="/docs/lindb/design/replication#reference"><span class="absolute -ml-8 hidden items-center border-0 opacity-0 group-hover:opacity-100 group-focus:opacity-100 lg:flex">​<span class="flex size-6 items-center justify-center rounded-md text-slate-400 shadow-sm ring-1 ring-slate-900/5 hover:text-slate-700 hover:shadow hover:ring-slate-900/10 dark:bg-slate-800 dark:text-slate-400 dark:shadow-none dark:ring-0 dark:hover:bg-slate-700 dark:hover:text-slate-200"><svg width="12" height="12" fill="none" aria-hidden="true"><path d="M3.75 1v10M8.25 1v10M1 3.75h10M1 8.25h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg></span></span>Reference</a></h4>
<ol>
<li><a target="_blank" href="https://github.com/bulldog2011/bigqueue"><em>bigqueue</em></a></li>
</ol></div><div class="mt-12 border-t border-slate-200 pt-6 text-sm leading-6 dark:border-slate-800"><div class="mb-10 flex items-center font-semibold text-slate-700 dark:text-slate-200"><div><div class="ml-1 text-xs text-slate-900 dark:text-white">Previous</div><a target="_self" class="group flex items-center text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/coordinator"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-4 text-slate-400 group-hover:text-slate-600 dark:group-hover:text-slate-300"><path fill-rule="evenodd" d="M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z" clip-rule="evenodd"></path></svg>Coordinator</a></div><div class="ml-auto text-right"><div class="mr-1 text-xs text-slate-900 dark:text-white">Next</div><a target="_self" class="group flex items-center text-slate-700 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/query">Query<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-4 text-slate-400 group-hover:text-slate-600 dark:group-hover:text-slate-300"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd"></path></svg></a></div></div></div><div><div class="group fixed right-5 top-[4em] z-50 flex rounded bg-gray-200 p-1 shadow-md shadow-gray-200 ring-1 ring-gray-200 lg:right-6 lg:top-20 xl:hidden dark:bg-slate-800 dark:shadow-slate-600 dark:ring-slate-600" data-headlessui-state=""><button type="button" aria-expanded="false" data-headlessui-state=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="size-6 fill-gray-400 stroke-gray-400 dark:fill-slate-500 dark:shadow-slate-600"><path fill-rule="evenodd" d="M2.625 6.75a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0A.75.75 0 0 1 8.25 6h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75ZM2.625 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0ZM7.5 12a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12A.75.75 0 0 1 7.5 12Zm-4.875 5.25a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg></button></div><div hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><div class="fixed bottom-0 right-[max(0px,calc(50%-45rem))] top-[3.8125rem] z-20 hidden w-[19.5rem] overflow-y-auto py-10 xl:block"><div class="px-2 xl:px-8"><h5 class="mb-2 text-sm font-semibold leading-6 text-slate-900 dark:text-slate-100">On this page</h5><ul class="text-sm leading-6 text-slate-700"><li><a target="_self" class="flex items-center gap-1 py-1 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/replication#overview">Overview</a></li><li><a target="_self" class="flex items-center gap-1 py-1 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/replication#local-replication">Local replication</a></li><li><a target="_self" class="flex items-center gap-1 py-1 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/replication#remote-replication">Remote replication</a></li><li><a target="_self" class="flex items-center gap-1 py-1 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="/docs/lindb/design/replication#sequentiality">Sequentiality</a></li></ul><div class="border-t border-slate-200 pt-3 text-sm leading-6 text-slate-700 sm:flex dark:border-slate-200/5"><a target="_blank" class="flex items-center gap-2 hover:text-slate-900 dark:text-slate-400 dark:hover:text-slate-300" href="https://github.com/lindb/lindb.github.io/edit/main/docs/lindb/10-design/03-replication.mdx"><svg viewBox="0 0 16 16" class="size-4" fill="currentColor" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>Edit this page on Github</a></div></div></div></div><footer class="justify-self-end py-4 lg:pt-8"><div class="mx-auto max-w-8xl"><div class="mx-8 grid gap-4 sm:gap-8 lg:mx-0 lg:grid-cols-8 lg:gap-12 lg:px-8"><div class="col-span-4 mb-6 lg:mb-0"><p class="flex items-center gap-4 font-semibold italic text-slate-900 dark:text-slate-100">An open-source, cloud native, observabilty platform</p><p class="flex items-center gap-2 pt-3 lg:gap-5 lg:pt-6"><a target="_blank" class="block text-slate-600 hover:text-slate-700 dark:text-gray-200 dark:hover:text-slate-300" href="https://github.com/lindb/lindb"><span class="sr-only">LinDB on GitHub</span><svg viewBox="0 0 16 16" class="size-5" fill="currentColor" aria-hidden="true"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a><a target="_blank" class="block text-slate-600 hover:text-slate-700 dark:text-gray-200 dark:hover:text-slate-300" href="https://x.com/lindb_io"><span class="sr-only">LinDB on Twitter</span><svg class="size-5" width="48" height="50" viewBox="0 0 48 50" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M28.5665 20.7714L46.4356 0H42.2012L26.6855 18.0355L14.2931 0H0L18.7397 27.2728L0 49.0548H4.23464L20.6196 30.0087L33.7069 49.0548H48L28.5655 20.7714H28.5665ZM22.7666 27.5131L5.76044 3.18778H12.2646L42.2032 46.012H35.699L22.7666 27.5142V27.5131Z" fill="currentColor"></path></svg></a></p></div><div class="col-span-2"><h3 class="mb-4 text-sm font-semibold text-slate-900 dark:text-slate-100">Open source</h3><ul><li class="mb-2"><a target="_blank" class="hover:text-stone-900 dark:hover:text-slate-300" href="https://github.com/lindb/linsight">Linsight</a></li><li class="mb-2"><a target="_blank" class="hover:text-stone-900 dark:hover:text-slate-300" href="https://github.com/lindb/lingo">Lingo</a></li><li class="mb-2"><a target="_self" class="hover:text-stone-900 dark:hover:text-slate-300" href="/oss/lindb">LinDB</a></li></ul></div><div class="col-span-2"><h3 class="mb-4 text-sm font-semibold text-slate-900 dark:text-slate-100">Resources</h3><ul><li class="mb-2"><a target="_self" class="hover:text-stone-900 dark:hover:text-slate-300" href="/docs/lindb/introduction">Documentation</a></li><li class="mb-2"><a target="_self" class="hover:text-stone-900 dark:hover:text-slate-300" href="/downloads/lindb">Downloads</a></li></ul></div></div><hr class="my-4 border-gray-200 dark:border-gray-700"/><span class="block text-center text-sm font-normal text-gray-600 dark:text-gray-400">Copyright © <!-- -->2024<!-- --> Lin Labs Inc. All Rights Reserved.</span></div></footer></div></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"page":{"path":"/docs/lindb/10-design/03-replication.mdx","meta":{"title":"Replication"},"title":"Replication","parent":"Design","commitInfo":{"author":"stone1100","date":"Mon Jun 24 07:03:27 2024"}},"source":{"compiledSource":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    code: \"code\",\n    div: \"div\",\n    em: \"em\",\n    h2: \"h2\",\n    h4: \"h4\",\n    img: \"img\",\n    li: \"li\",\n    ol: \"ol\",\n    p: \"p\",\n    path: \"path\",\n    strong: \"strong\",\n    svg: \"svg\",\n    ul: \"ul\",\n    ..._provideComponents(),\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h2, {\n      children: \"Overview\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"For the replication of distributed storage, consensus protocols such as Paxos, Raft, and ZAB are commonly used in the industry. More than half of these protocols will sacrifice certain performance to strictly ensure data consistency.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The scenario faced by \", _jsx(_components.strong, {\n        children: \"LinDB\"\n      }), \" is that the amount of writing is huge, and the requirements for data consistency are not high. It also allows short-term data inconsistency and eventually consistent. Therefore, \", _jsx(_components.strong, {\n        children: \"LinDB\"\n      }), \" adopts the strategy that when successfully written to the \", _jsx(_components.strong, {\n        children: \"Leader\"\n      }), \" the write operation is successful.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Written to \", _jsx(_components.strong, {\n        children: \"Leader\"\n      }), \" is successful has the following benefits:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Improving write performance;\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Any machine can be deployed in the cluster, while Paxos, Raft, ZAB, etc. require at least 3 machines;\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Written to \", _jsx(_components.strong, {\n        children: \"Leader\"\n      }), \" is successful, has the following problems:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Data consistency problem: once the \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" is down, a new \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" will be elected, then the new \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" copying new data may overwrite the data written by the old \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \";\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Data loss problem: once \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" is down, and the data block which was not copied to \", _jsx(_components.strong, {\n          children: \"Follower\"\n        }), \" is also damaged at this time, this part of data will be lost;\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In order to solve the above problems and try to ensure that data is not lost, \", _jsx(_components.strong, {\n        children: \"LinDB\"\n      }), \" adopts a multichannel replication scheme, as shown in the following figure:\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/img/lindb/design/storage_database.png\",\n        alt: \"Databae storage shard\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Take the data shard \", _jsx(_components.strong, {\n        children: \"Shard 3\"\n      }), \" as an example:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"When \", _jsx(_components.strong, {\n          children: \"Node 1\"\n        }), \" is a \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \", \", _jsx(_components.strong, {\n          children: \"1-WAL\"\n        }), \" write channel is enabled, \", _jsx(_components.strong, {\n          children: \"Node 1\"\n        }), \" receives new data and writes it to the \", _jsx(_components.strong, {\n          children: \"1-WAL\"\n        }), \" channel, and replicating the data into \", _jsx(_components.strong, {\n          children: \"1-WAL\"\n        }), \" channel of \", _jsx(_components.strong, {\n          children: \"Node 2\"\n        }), \" and \", _jsx(_components.strong, {\n          children: \"Node 4\"\n        }), \";\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"When \", _jsx(_components.strong, {\n          children: \"Node 1\"\n        }), \" is down and \", _jsx(_components.strong, {\n          children: \"Node 2\"\n        }), \" is elected as the new \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \", the \", _jsx(_components.strong, {\n          children: \"2-WAL\"\n        }), \" write channel is enabled, and \", _jsx(_components.strong, {\n          children: \"Node 2\"\n        }), \" receives new data and replicating the data into \", _jsx(_components.strong, {\n          children: \"2-WAL\"\n        }), \" channel of \", _jsx(_components.strong, {\n          children: \"Node 4\"\n        }), \";\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"When \", _jsx(_components.strong, {\n          children: \"Node 1\"\n        }), \" is up again, \", _jsx(_components.strong, {\n          children: \"Node 1\"\n        }), \" continue to copy the data into \", _jsx(_components.strong, {\n          children: \"1-WAL\"\n        }), \" channel that has not been copied to \", _jsx(_components.strong, {\n          children: \"Node 2\"\n        }), \" and \", _jsx(_components.strong, {\n          children: \"Node 4\"\n        }), \" to their corresponding \", _jsx(_components.strong, {\n          children: \"1-WAL\"\n        }), \" channels . \", _jsx(_components.strong, {\n          children: \"Node 2\"\n        }), \" will supplement the data in the \", _jsx(_components.strong, {\n          children: \"2-WAL\"\n        }), \" channel to the \", _jsx(_components.strong, {\n          children: \"2-WAL\"\n        }), \" channel of \", _jsx(_components.strong, {\n          children: \"Node 1\"\n        }), \";\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"That is, data in write channel flows from \", _jsx(_components.strong, {\n        children: \"Leader\"\n      }), \". For example, the \", _jsx(_components.strong, {\n        children: \"1-WAL\"\n      }), \" channel is always the \", _jsx(_components.strong, {\n        children: \"Node 1\"\n      }), \" replication channel to \", _jsx(_components.strong, {\n        children: \"Node 2\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"Node 4\"\n      }), \", and the \", _jsx(_components.strong, {\n        children: \"2-WAL\"\n      }), \" channel is always \", _jsx(_components.strong, {\n        children: \"Node 2\"\n      }), \" replication channels to \", _jsx(_components.strong, {\n        children: \"Node 1\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"Node 4\"\n      }), \", \", _jsx(_components.strong, {\n        children: \"4-WAL\"\n      }), \" channel is always \", _jsx(_components.strong, {\n        children: \"Node 4\"\n      }), \" replication channel to \", _jsx(_components.strong, {\n        children: \"Node 1\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"Node 2\"\n      }), \", and so on,\"]\n    }), \"\\n\", _jsxs(_components.div, {\n      className: \"markdown-alert markdown-alert-tip\",\n      dir: \"auto\",\n      children: [\"\\n\", _jsxs(_components.p, {\n        className: \"markdown-alert-title\",\n        dir: \"auto\",\n        children: [_jsx(_components.svg, {\n          className: \"octicon\",\n          viewBox: \"0 0 16 16\",\n          width: \"16\",\n          height: \"16\",\n          \"aria-hidden\": \"true\",\n          children: _jsx(_components.path, {\n            d: \"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z\"\n          })\n        }), \"TIP\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"Node 1\"\n        }), \" corresponds to the unique identifier \", _jsx(_components.strong, {\n          children: \"1\"\n        }), \" in the cluster, and so on for other nodes.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This way of replication solves the following problems:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Avoid data inconsistency: only one node is responsible for the authority of the data for each channel, so there will be no conflict;\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Avoid data loss as much as possible: as long as the data which has not been copied in the old \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" is still persistent at disk, it will be copied to other replicas after it gets up again. If the data that has not been copied in the old \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" is lost, then which will be lost forever;\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Preconditions for multichannel replication:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"Out of order is allowed: data written to multiple channels loses its order. Transactions are not required for Time series data scenarios faced by \", _jsx(_components.strong, {\n          children: \"LinDB\"\n        }), \" so out of order is allowed.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.div, {\n      className: \"markdown-alert markdown-alert-tip\",\n      dir: \"auto\",\n      children: [\"\\n\", _jsxs(_components.p, {\n        className: \"markdown-alert-title\",\n        dir: \"auto\",\n        children: [_jsx(_components.svg, {\n          className: \"octicon\",\n          viewBox: \"0 0 16 16\",\n          width: \"16\",\n          height: \"16\",\n          \"aria-hidden\": \"true\",\n          children: _jsx(_components.path, {\n            d: \"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z\"\n          })\n        }), \"TIP\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Since a major feature of time series data is time correlation, \", _jsx(_components.strong, {\n          children: \"LinDB\"\n        }), \" also shards data by time according to this feature when storing data. Each time shard is a storage unit, so the actual replication channel is also stored with Units correspond one-to-one.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Local replication\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/img/lindb/design/local_replication.png\",\n        alt: \"Local replication\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The entire Local Replication writing process is as follows:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"The system will start a writing goroutine for each \", _jsx(_components.strong, {\n          children: \"Shard\"\n        }), \" replication channel, this goroutine is responsible for all write operations on this channel, whatever it is a \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" or a \", _jsx(_components.strong, {\n          children: \"Follower\"\n        }), \";\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"First, data corresponding to \", _jsx(_components.strong, {\n          children: \"namespace/metric name/tags/fields\"\n        }), \" into the index file of the database will be written, and the corresponding \", _jsx(_components.strong, {\n          children: \"metric id/time series id/field id\"\n        }), \" will be generated, this operation is  mainly about completing the conversion of \", _jsx(_components.strong, {\n          children: \"string-\u003eint\"\n        }), \"; Advantage of this conversion is that all data are stored in data types to reduce the overall storage size, because for each data point, metadata such as \", _jsx(_components.strong, {\n          children: \"namespace/metric name/tags/fields\"\n        }), \" is occupied by such as \", _jsxs(_components.strong, {\n          children: [\"cpu{host= 1.1.1.1} load=1 \", _jsx(_components.a, {\n            href: \"https://github.com/lindb/lindb/commit/1514214168614\",\n            children: _jsx(_components.code, {\n              children: \"1514214\"\n            })\n          })]\n        }), \",\\nIn fact, after converting to \", _jsx(_components.strong, {\n          children: \"id\"\n        }), \", the storage will be \", _jsx(_components.strong, {\n          children: \"cpu =\u003e 1(metric id), host=1.1.1.1 =\u003e 1(time series id), load =\u003e 1(field id)\"\n        }), \", simplified to \", _jsxs(_components.strong, {\n          children: [\"1 1 \", _jsx(_components.a, {\n            href: \"https://github.com/lindb/lindb/commit/1514214168614\",\n            children: _jsx(_components.code, {\n              children: \"1514214\"\n            })\n          }), \" =\u003e1\"]\n        }), \", please refer to \", _jsx(_components.a, {\n          href: \"/docs/lindb/design/inverted-index\",\n          children: \"inverted index\"\n        }), \" for the specific index structure;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"If writing index operation fails, it is considered that the writing has failed, and the failure is composed of two cases;\", \"\\n\", _jsxs(_components.ol, {\n          children: [\"\\n\", _jsx(_components.li, {\n            children: \"Bad data writing format, such failures are directly marked as failures;\"\n          }), \"\\n\", _jsx(_components.li, {\n            children: \"Internal failure, the writing operations will be retried;\"\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"When obtained \", _jsx(_components.strong, {\n          children: \"ID\"\n        }), \", data will be written into storage uint, this process is similar to \", _jsx(_components.strong, {\n          children: \"LSM\"\n        }), \", which writes data into the memory database firstly, and directly write to the memory to achieve high throughput performance. After the size of memory data reaches the memory limit, the \", _jsx(_components.strong, {\n          children: \"Flush\"\n        }), \" operation will be triggered. For details, please refer to \", _jsx(_components.a, {\n          href: \"/docs/lindb/design/storage\",\n          children: \"Storage Format\"\n        }), \", \", _jsx(_components.a, {\n          href: \"/docs/lindb/design/memory-database\",\n          children: \"Memory Database\"\n        }), \";\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Here are two import replication \", _jsx(_components.strong, {\n        children: \"Index\"\n      }), \" for write operations:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Consume(Replica) Index\"\n        }), \": where the writing goroutine has been processed, each write operation will first verify whether the \", _jsx(_components.strong, {\n          children: \"Index\"\n        }), \" is legal;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Ack Index\"\n        }), \": which data in this channel has been successfully written and persisted to storage;\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Here are a few things to note:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"The writing goroutine will consume the written data from the \", _jsx(_components.strong, {\n          children: \"WAL\"\n        }), \" channel in order, so the \", _jsx(_components.strong, {\n          children: \"Replica Index\"\n        }), \" is an ordered pointer, so it is easy to check with the persisted \", _jsx(_components.strong, {\n          children: \"Index\"\n        }), \" to verify the data whether it has been written;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"The \", _jsx(_components.strong, {\n          children: \"Flush\"\n        }), \" goroutine is used to synchronize the \", _jsx(_components.strong, {\n          children: \"Ack Index\"\n        }), \" to notify which data has been written successfully;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Since all write operations write into memory firstly, and then persist the data into corresponding file. If the system crashes during this process, as there is no \", _jsx(_components.strong, {\n          children: \"Ack Index\"\n        }), \", even if the data in the memory is lost, but when the goroutine starts again, it consumes the data in the \", _jsx(_components.strong, {\n          children: \"WAL\"\n        }), \" channel with \", _jsx(_components.strong, {\n          children: \"Ack Index\"\n        }), \" as the current \", _jsx(_components.strong, {\n          children: \"Replica Index\"\n        }), \". This consuming process achieved that data can be recovered after crashing;\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Remote replication\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Pick \", _jsx(_components.strong, {\n        children: \"Node 1\"\n      }), \" as \", _jsx(_components.strong, {\n        children: \"Leader\"\n      }), \" in the above figure with 3 Replications replicating data from \", _jsx(_components.strong, {\n        children: \"1-WAL\"\n      }), \" as an example:\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Node 1\"\n      }), \" acts a \", _jsx(_components.strong, {\n        children: \"Leader\"\n      }), \" of the shard to accept written data from \", _jsx(_components.strong, {\n        children: \"Broker\"\n      }), \", \", _jsx(_components.strong, {\n        children: \"Node 2\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"Node 4\"\n      }), \" are both \", _jsx(_components.strong, {\n        children: \"Follower\"\n      }), \" accepting the replication request of \", _jsx(_components.strong, {\n        children: \"Node 1\"\n      }), \", meanwhile the \", _jsx(_components.strong, {\n        children: \"1-WAL\"\n      }), \" channel is used as data write channel.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.img, {\n        src: \"/img/lindb/design/remote_replication.png\",\n        alt: \"Remote replication\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"Index\"\n      }), \" basic concept description:\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Append Index\"\n        }), \" of each channel, indicating the writing position of the channel ;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Each channel retains each \", _jsx(_components.strong, {\n          children: \"Follower Consumer (Replica) Index\"\n        }), \" and \", _jsx(_components.strong, {\n          children: \"Ack Index\"\n        }), \", respectively indicating the position where each \", _jsx(_components.strong, {\n          children: \"Follower\"\n        }), \" is consumed (consumed but the request is still without successful consumption acknowledged) and position of successful consumption;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Tail Index\"\n        }), \" of each channel: indicates the minimum value of all \", _jsx(_components.strong, {\n          children: \"Follower Ack Index\"\n        }), \", \", _jsx(_components.strong, {\n          children: \"WAL\"\n        }), \" before the \", _jsx(_components.strong, {\n          children: \"Index\"\n        }), \" is deletable ;\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The entire replication process is as follows:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" will start an independent goroutine for each \", _jsx(_components.strong, {\n          children: \"Follower\"\n        }), \" replication, get \", _jsx(_components.strong, {\n          children: \"Follower Consumer(Replica) Index\"\n        }), \" from \", _jsx(_components.strong, {\n          children: \"WAL\"\n        }), \" of \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" then send it to \", _jsx(_components.strong, {\n          children: \"Follower\"\n        }), \";\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Follower\"\n        }), \" compares the \", _jsx(_components.strong, {\n          children: \"Append Index\"\n        }), \" with \", _jsx(_components.strong, {\n          children: \"Consumer(Replica) Index\"\n        }), \" in local \", _jsx(_components.strong, {\n          children: \"WAL\"\n        }), \";\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"On equal: return \", _jsx(_components.strong, {\n              children: \"Consumer Index\"\n            }), \" to \", _jsx(_components.strong, {\n              children: \"Leader\"\n            }), \" as \", _jsx(_components.strong, {\n              children: \"Ack Index\"\n            }), \" (normal case);\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"On not equal, return the \", _jsx(_components.strong, {\n              children: \"Append Index\"\n            }), \" in its own local \", _jsx(_components.strong, {\n              children: \"WAL\"\n            }), \" to \", _jsx(_components.strong, {\n              children: \"Leader\"\n            }), \";\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"After \", _jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" receiving response, detect whether the \", _jsx(_components.strong, {\n          children: \"Ack Index\"\n        }), \" of\", _jsx(_components.strong, {\n          children: \"Follower\"\n        }), \" is equal to \", _jsx(_components.strong, {\n          children: \"Consumer(Replica) Index\"\n        }), \";\", \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [\"On equal: update the \", _jsx(_components.strong, {\n              children: \"Ack Index\"\n            }), \" of the \", _jsx(_components.strong, {\n              children: \"Follower\"\n            }), \" (normal case);\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [\"On not equal: here are some cases:\", \"\\n\", _jsxs(_components.ul, {\n              children: [\"\\n\", _jsxs(_components.li, {\n                children: [\"On \", _jsx(_components.strong, {\n                  children: \"Follower Ack Index\"\n                }), \" smaller than \", _jsx(_components.strong, {\n                  children: \"Tail Index\"\n                }), \" of \", _jsx(_components.strong, {\n                  children: \"Leader WAL\"\n                }), \": this means that \", _jsx(_components.strong, {\n                  children: \"Follower\"\n                }), \" local \", _jsx(_components.strong, {\n                  children: \"Append Index\"\n                }), \" is too small while \", _jsx(_components.strong, {\n                  children: \"Leader\"\n                }), \" has no data at that position, then \", _jsx(_components.strong, {\n                  children: \"Follower\"\n                }), \" should reset its own \", _jsx(_components.strong, {\n                  children: \"Append Index\"\n                }), \" as \", _jsx(_components.strong, {\n                  children: \"Tail Index\"\n                }), \" of \", _jsx(_components.strong, {\n                  children: \"Leader\"\n                }), \";\"]\n              }), \"\\n\", _jsxs(_components.li, {\n                children: [\"On \", _jsx(_components.strong, {\n                  children: \"Follower Ack Index\"\n                }), \" is greater than the \", _jsx(_components.strong, {\n                  children: \"Append Index\"\n                }), \" of the \", _jsx(_components.strong, {\n                  children: \"Leader WAL\"\n                }), \": this means that the \", _jsx(_components.strong, {\n                  children: \"Append Index\"\n                }), \" of the \", _jsx(_components.strong, {\n                  children: \"Follower\"\n                }), \" is too large, and the \", _jsx(_components.strong, {\n                  children: \"Leader\"\n                }), \" has no data at this position, and the \", _jsx(_components.strong, {\n                  children: \"Leader WAL\"\n                }), \" needs to be changed. Append Index** is raised to \", _jsx(_components.strong, {\n                  children: \"Follower Ack Index\"\n                }), \", and \", _jsx(_components.strong, {\n                  children: \"Follower Consumer(Replica) Index\"\n                }), \" is raised to \", _jsx(_components.strong, {\n                  children: \"Follower Ack Index\"\n                }), \";\"]\n              }), \"\\n\", _jsxs(_components.li, {\n                children: [\"On \", _jsx(_components.strong, {\n                  children: \"Follower\"\n                }), \" is between \", _jsx(_components.strong, {\n                  children: \"Tail Index\"\n                }), \" and \", _jsx(_components.strong, {\n                  children: \"Append Index\"\n                }), \" of \", _jsx(_components.strong, {\n                  children: \"Leader WAL\"\n                }), \": \", _jsx(_components.strong, {\n                  children: \"Follower Consumer(Replica) Index\"\n                }), \" will be reset to \", _jsx(_components.strong, {\n                  children: \"Follower Ack Index\"\n                }), \";\"]\n              }), \"\\n\"]\n            }), \"\\n\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The process of \", _jsx(_components.strong, {\n        children: \"Leader\"\n      }), \" and \", _jsx(_components.strong, {\n        children: \"Follower\"\n      }), \" to initialize the replication channel is similar to \", _jsx(_components.strong, {\n        children: \"TCP\"\n      }), \" three-way handshake.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Sequentiality\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Generally speaking, multichannel replication does not guarantee the order of the overall data. In most cases, only one of the channels is used. It is necessary to ensure the order of replication of the channel. With sequentiality, it is easier to know which data has been copied. Which data has not been replicated.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"To ensure the sequentiality of replication process, it is necessary to ensure the order of the following steps:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" send replication requests in order;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Follower\"\n        }), \" processes replication request in order;\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Leader\"\n        }), \" responses to replication request in order;\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Since the entire writing and replication process is based on the \", _jsx(_components.strong, {\n        children: \"GRPC Stream\"\n      }), \" long connection and single-goroutine processing mechanism, the above conditions can basically be guaranteed.\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Reference\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://github.com/bulldog2011/bigqueue\",\n          children: _jsx(_components.em, {\n            children: \"bigqueue\"\n          })\n        })\n      }), \"\\n\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = {\n    ..._provideComponents(),\n    ...props.components\n  };\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"tocItems":[{"id":"overview","level":2,"title":"Overview"},{"id":"local-replication","level":2,"title":"Local replication"},{"id":"remote-replication","level":2,"title":"Remote replication"},{"id":"sequentiality","level":2,"title":"Sequentiality"}],"releases":null,"sidebar":[{"index":2,"title":"Getting Started","children":[{"index":1,"title":"Docker","children":[],"href":"/docs/lindb/getting-started/docker"},{"index":2,"title":"Package","children":[],"href":"/docs/lindb/getting-started/package"}]},{"index":3,"title":"Developer Guide","children":[{"index":1,"title":"Connect","children":[],"href":"/docs/lindb/developer-guide/connect"},{"index":2,"title":"Create a database","children":[],"href":"/docs/lindb/developer-guide/create-database"},{"index":3,"title":"Insert data","children":[],"href":"/docs/lindb/developer-guide/insert-data"},{"index":4,"title":"Query data","children":[],"href":"/docs/lindb/developer-guide/query-data"}]},{"index":4,"title":"Deployment","children":[{"index":1,"title":"Kubernetes","children":[],"href":"/docs/lindb/deployment/kubernetes"},{"index":2,"title":"Manual deployment","children":[],"href":"/docs/lindb/deployment/manual"}]},{"index":5,"title":"Client","children":[{"index":1,"title":"CLI","children":[],"href":"/docs/lindb/client/cli"},{"index":2,"title":"Client libraries","children":[],"href":"/docs/lindb/client/client-libraries"},{"index":3,"title":"Go","children":[],"href":"/docs/lindb/client/go"},{"index":4,"title":"Java","children":[],"href":"/docs/lindb/client/java"}]},{"index":6,"title":"Lin Ql","children":[{"index":1,"title":"Lin query language","children":[],"href":"/docs/lindb/lin-ql/sql"}]},{"index":7,"title":"Admin Console","children":[{"index":1,"title":"Introduction","children":[],"href":"/docs/lindb/admin-console/index"},{"index":2,"title":"Cluster overview","children":[],"href":"/docs/lindb/admin-console/overview"},{"index":3,"title":"Data search","children":[],"href":"/docs/lindb/admin-console/search"},{"index":4,"title":"Data explore","children":[],"href":"/docs/lindb/admin-console/explore"},{"index":5,"title":"Cluster monitoring","children":[],"href":"/docs/lindb/admin-console/monitoring"},{"index":6,"title":"Metadata","children":[],"href":"/docs/lindb/admin-console/metadata"}]},{"index":8,"title":"Api","children":[{"index":1,"title":"Introduction","children":[],"href":"/docs/lindb/api/index"},{"index":2,"title":"Insert","children":[],"href":"/docs/lindb/api/insert"},{"index":3,"title":"Query","children":[],"href":"/docs/lindb/api/query"},{"index":4,"title":"State","children":[],"href":"/docs/lindb/api/state"}]},{"index":9,"title":"Reference","children":[{"index":1,"title":"Data Model","children":[],"href":"/docs/lindb/reference/data-model"},{"index":2,"title":"Metric","children":[],"href":"/docs/lindb/reference/metric"},{"index":3,"title":"Configuration","children":[],"href":"/docs/lindb/reference/configuration"}]},{"index":10,"title":"Design","children":[{"index":1,"title":"Architecture","children":[],"href":"/docs/lindb/design/architecture"},{"index":2,"title":"Coordinator","children":[],"href":"/docs/lindb/design/coordinator"},{"index":3,"title":"Replication","children":[],"href":"/docs/lindb/design/replication"},{"index":4,"title":"Query","children":[],"href":"/docs/lindb/design/query"},{"index":5,"title":"Storage","children":[],"href":"/docs/lindb/design/storage"},{"index":6,"title":"Memory database","children":[],"href":"/docs/lindb/design/memory-database"},{"index":7,"title":"Inverted index","children":[],"href":"/docs/lindb/design/inverted-index"}]}],"locale":"","_nextI18Next":{"initialI18nStore":{"en":{"translation":{"Lin Ql":"Lin QL","Api":"API"}}},"initialLocale":"en","ns":["translation"],"userConfig":null}},"__N_SSG":true},"page":"/docs/[[...slug]]","query":{"slug":["lindb","design","replication"]},"buildId":"-NtRW_Tocke_77ve0GfWf","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>